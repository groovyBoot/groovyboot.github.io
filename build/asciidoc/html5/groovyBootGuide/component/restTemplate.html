<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.4">
<meta name="author" content="作者：张宇">
<title>gb中 RestTemplate 使用</title>

<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>gb中 RestTemplate 使用</h1>
<div class="details">
<span id="author" class="author">作者：张宇</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#介绍">1. 介绍</a></li>
<li><a href="#_在项目中使用resttemplate">2. 在项目中使用RestTemplate</a>
<ul class="sectlevel2">
<li><a href="#_build_gradle中增加rest">2.1. build.gradle中增加rest</a></li>
<li><a href="#_配置application_yml">2.2. 配置application.yml</a></li>
<li><a href="#_配置resttemplate">2.3. 配置restTemplate</a></li>
<li><a href="#_增加gbrestcontroller或restcontroller注解类的controller">2.4. 增加GbRestController或RestController注解类的controller</a></li>
<li><a href="#_访问应用地址查看效果">2.5. 访问应用地址查看效果</a></li>
</ul>
</li>
<li><a href="#_在springboot中resttemplate的知识点">3. 在springboot中RestTemplate的知识点</a>
<ul class="sectlevel2">
<li><a href="#_初始化bean">3.1. 初始化Bean</a></li>
<li><a href="#_设置超时参数">3.2. 设置超时参数</a></li>
<li><a href="#_设置错误返回处理">3.3. 设置错误返回处理</a></li>
<li><a href="#_错误的全局统一处理">3.4. 错误的全局统一处理</a></li>
<li><a href="#_微服务中resttemplate使用_精读">3.5. 微服务中RestTemplate使用(精读)</a></li>
</ul>
</li>
<li><a href="#_resttemplate使用详解_略读">4. RestTemplate使用详解（略读）</a>
<ul class="sectlevel2">
<li><a href="#_get请求_2">4.1. GET请求</a></li>
<li><a href="#_post请求">4.2. POST请求</a></li>
<li><a href="#_postforobject">4.3. postForObject</a></li>
<li><a href="#_put请求_2">4.4. PUT请求</a></li>
<li><a href="#_delete请求_2">4.5. DELETE请求</a></li>
<li><a href="#_exchange">4.6. exchange</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="介绍">1. 介绍</h2>
<div class="sectionbody">
<div class="paragraph">
<p>微服务应用之间访问分为HTTP，RPC两种方式，这里讨论HTTP即应用服务端间后台访问。 其中常用的访问工具包括早期的HttpClient,后续的RestTemplate、Feign、WebClient等，本篇文章主要讲述RestTemplate。</p>
</div>
<div class="paragraph">
<p>RestTemplate 是 Spring 提供的用于访问 Rest 服务的客户端，RestTemplate 提供了多种可以便捷访问远程 Http 服务的方法，能够大大提高客户端的编写效率。</p>
</div>
<div class="paragraph">
<p>RestTemplate 是 Spring 3 中引入的同步阻塞式 HTTP 客户端。在 Spring 5 中引入了 WebClient 作为非阻塞式 Reactive HTTP 客户端。</p>
</div>
<div class="paragraph">
<p>（2）RestTemplate 定义了 36 个与 REST 资源交互的方法，其中的大多数都对应于 HTTP 的方法。</p>
</div>
<div class="paragraph">
<p>注意： 严格来说只有 11 个独立的方法，其中有 10 个有三种重载形式，而第 11 个则重载了 6 次，这样一共形成了 36 个方法。</p>
</div>
<div class="paragraph">
<p>实际上，由于 Post 操作的非幂等性，它几乎可以代替其他的 CRUD 操作。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>delete()：这个方法是在特定的 URL 上对资源执行 HTTP DELETE 操作
exchange()：在 URL 上执行特定的 HTTP 方法，返回包含对象的 ResponseEntity，这个对象是从响应体中映射得到的
execute()：在 URL 上执行特定的 HTTP 方法，返回一个从响应体映射得到的对象
getForEntity()：发送一个 HTTP GET 请求，返回的 ResponseEntity 包含了响应体所映射成的对象
getForObject()：发送一个 HTTP GET 请求，返回的请求体将映射为一个对象
postForEntity()：POST 数据到一个 URL，返回包含一个对象的 ResponseEntity，这个对象是从响应体中映射得到的
postForObject()：POST 数据到一个 URL，返回根据响应体匹配形成的对象
headForHeaders()：发送 HTTP HEAD 请求，返回包含特定资源 URL 的 HTTP 头
optionsForAllow()：发送 HTTP OPTIONS 请求，返回对特定 URL 的 Allow 头信息
postForLocation()：POST 数据到一个 URL，返回新创建资源的 URL
put()：PUT 资源到特定的 URL</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_在项目中使用resttemplate">2. 在项目中使用RestTemplate</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_build_gradle中增加rest">2.1. build.gradle中增加rest</h3>
<div class="listingblock">
<div class="content">
<pre>    implementation('org.yunchen.gb:gb-core:x.x.x')</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_配置application_yml">2.2. 配置application.yml</h3>
<div class="listingblock">
<div class="content">
<pre>gb:
  rest:
    prefix:                            <i class="conum" data-value="1"></i><b>(1)</b>
    unifiedJsonResult: true            <i class="conum" data-value="2"></i><b>(2)</b></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>GbRestController或RestController注解的类访问前增加的前缀，默认为/api，置空后为/</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>启用统一json格式，GbRestController或RestController注解的类的返回结果将统一按照UnifiedResult类进行处理</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_配置resttemplate">2.3. 配置restTemplate</h3>
<div class="sect3">
<h4 id="_增加gbresttemplateerrorhandler类">2.3.1. 增加GbRestTemplateErrorHandler类</h4>
<div class="listingblock">
<div class="content">
<pre>public class GbRestTemplateErrorHandler extends DefaultResponseErrorHandler {
    @Override
    public boolean hasError(ClientHttpResponse clientHttpResponse) throws IOException {
        // 返回false表示不管response的status是多少都返回没有错
        return false;
    }
}</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_添加resttemplate类的bean">2.3.2. 添加restTemplate类的bean</h4>
<div class="paragraph">
<p>在conf类或application类中增加如下的代码：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    @Bean
    public RestTemplate getRestTemplate(ClientHttpRequestFactory simleClientHttpRequestFactory) {
        RestTemplate restTemplate = new RestTemplate();
        restTemplate.setErrorHandler(new GbRestTemplateErrorHandler());
        restTemplate.setRequestFactory(simleClientHttpRequestFactory);
        return restTemplate;
    }

    @Bean
    public ClientHttpRequestFactory getSimpleClientHttpRequestFactory() {
        SimpleClientHttpRequestFactory factory = new SimpleClientHttpRequestFactory();
        factory.setReadTimeout(5000);//单位为ms
        factory.setConnectTimeout(5000);//单位为ms
        return factory;
    }</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_增加gbrestcontroller或restcontroller注解类的controller">2.4. 增加GbRestController或RestController注解类的controller</h3>
<div class="listingblock">
<div class="content">
<pre>@GbRestController
class RestDataController {
    //网关位置
    private String BASEURI = "http://localhost:8021/";

    @Autowired private RestTemplate restTemplate;

    public Map simple(HttpServletResponse response) {
        String url = BASEURI;
        //示例参数
        Map params=[paramval:"666"]
        //示例header
        HttpHeaders headers = new HttpHeaders();
        headers.add("VISITKEY","UUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUU");
        HttpEntity&lt;String&gt; entity = new HttpEntity&lt;String&gt;(null,headers);
        //GET方式采用品街方法，可以不写最后的参数
        //ResponseEntity&lt;String&gt; resp = restTemplate.exchange(url+"gjjsch/"+"666", HttpMethod.GET, entity, String.class);
        //参数替代方法，即大括号{key},map中包含对应key即value，最终使用value替换对应变量位置
        ResponseEntity&lt;String&gt; resp  = restTemplate.exchange(url+"gjjsch/{paramval}", HttpMethod.GET, entity, String.class,params);
        // 判断请求是否发生异常
        if(!resp.getStatusCode().is2xxSuccessful()){
            //response.setStatus(HttpStatus.CONFLICT.value())  //409 状态码
            response.setStatus(resp.getStatusCodeValue())  //同步状态码
            return [message:resp.getStatusCode().name(),status:resp.getStatusCodeValue(),header:resp.getHeaders(),body:new ObjectMapper().readValue(resp.getBody(),Map.class)]
        }
        return [result:new ObjectMapper().readValue(resp.getBody(),Map.class)]
}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_访问应用地址查看效果">2.5. 访问应用地址查看效果</h3>
<div class="paragraph">
<p>浏览器访问应用地址 <a href="http://localhost:8080/restData/simple" class="bare">http://localhost:8080/restData/simple</a> ，应用访问网关返回正常结果</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{"status":200,"errorCode":"","errorMsg":"","resultBody":{"result":{total:0,rows:{}}}}</pre>
</div>
</div>
<div class="paragraph">
<p>返回错误结果</p>
</div>
<div class="listingblock">
<div class="content">
<pre>{"status":404,"errorCode":"","errorMsg":"","resultBody":{"message":"NOT_FOUND","status":404,"header":{"Content-Type":["application/json;charset=UTF-8"],"Transfer-Encoding":["chunked"],"Date":["Sun, 12 Apr 2020 05:43:21 GMT"]},"body":{"timestamp":"2020-04-12T05:43:20.923+0000","status":404,"error":"Not Found","message":"No message available","path":"/gjjsch/666"}}}</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_在springboot中resttemplate的知识点">3. 在springboot中RestTemplate的知识点</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_初始化bean">3.1. 初始化Bean</h3>
<div class="paragraph">
<p>在springboot启动类或者配置类中声明</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    @Bean
    //@LoadBalanced  <i class="conum" data-value="1"></i><b>(1)</b>
    public RestTemplate restTemplate()
    {

        RestTemplate restTemplate = new RestTemplate();
        return restTemplate;
    }</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>在微服务（SpringCloud）应用中注解@LoadBalanced可以让RestTemplate自动注入负载均衡处理，前提是应用也作为服务端注册到中心。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>作为微服务客户端访问HTTP请求时，访问url格式为：http://服务名/映射链接，如果调用的服务存在上下文，那么则要通过http://服务名/服务上下文/映射链接</p>
</div>
<div class="paragraph">
<p>在使用ApiGateway网关模式的情况下，由网关负责负载均衡，访问url格式应为：http://网关地址、端口/映射链接，如果调用的服务存在上下文，那么则要通过http://网关地址、端口/服务上下文/映射链接</p>
</div>
<div class="paragraph">
<p>也就是按照IP端口方式访问。</p>
</div>
</div>
<div class="sect2">
<h3 id="_设置超时参数">3.2. 设置超时参数</h3>
<div class="listingblock">
<div class="content">
<pre>    @Bean
    public ClientHttpRequestFactory simpleClientHttpRequestFactory() {
        SimpleClientHttpRequestFactory factory = new SimpleClientHttpRequestFactory();
        factory.setReadTimeout(5000);//单位为ms
        factory.setConnectTimeout(5000);//单位为ms
        return factory;
    }</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_设置错误返回处理">3.3. 设置错误返回处理</h3>
<div class="paragraph">
<p>当使用 RestTemplate 发送请求时， 如果接口返回的不是 200 状态（而是 4xx、5xx 这样的异常状态），则会抛出异常报错
在实际接口对接中，需要获取接口返回的异常信息并返回（比如返回到前端）。 具体实现可以通过自定义 RestTemplate 异常的处理来实现。</p>
</div>
<div class="paragraph">
<p>注：上述问题不仅仅是在GetForObject,PostForObject存在，所有以execute为基础调用的方法都存在，简单说不仅仅因为是GetForEntity，或者PostForEntity就能避免404异常的抛出。</p>
</div>
<div class="paragraph">
<p>（1）首先我们需要创建一个自己的异常处理控制器（ExceptionHandler 类），该类实现 ResponseErrorHandler 接口。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>public class RestThrowErrorHandler implements ResponseErrorHandler {

    @Override
    public boolean hasError(ClientHttpResponse response) throws IOException {
        // 返回false表示不管response的status是多少都返回没有错
        // 这里可以自己定义那些status code你认为是可以抛Error
        return false;
    }

    @Override
    public void handleError(ClientHttpResponse response) throws IOException {
        // 这里面可以实现你自己遇到了Error进行合理的处理
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>（2）在 RestTemplate 配置类中，指定使用自定义的异常处理控制。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@Configuration
public class RestTemplateConfig {

    @Bean
    public RestTemplate restTemplate(ClientHttpRequestFactory factory){
        RestTemplate restTemplate = new RestTemplate(factory);
        //Response status code 4XX or 5XX to the client.
        restTemplate.setErrorHandler(new RestThrowErrorHandler());
        return restTemplate;
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>（3）最后写是一个简单的请求样例。经过上面设置后，无论请求成功或者失败都会返回（不会抛异常），所以需要通过状态码来判断请求是否成功。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@RestController
public class HelloController {

    @Autowired
    private RestTemplate restTemplate;

    @GetMapping("/test")
    public String test() {
        String url = "http://localhost:8080/xxxxxx";
        ResponseEntity&lt;String&gt; responseEntity = restTemplate.getForEntity(url, String.class);
        // 判断请求是否发生异常
        if(!responseEntity.getStatusCode().is2xxSuccessful()){
            // 返回异常信息
            return "请求失败，异常信息：" + responseEntity.getBody();
        }
        // 没有异常的话则返回正常的响应结果
        return responseEntity.getBody();
    }
}</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_错误的全局统一处理">3.4. 错误的全局统一处理</h3>
<div class="paragraph">
<p>本部分仅为参考，可根据实际需要进行运用。</p>
</div>
<div class="paragraph">
<p>（1）通常不会直接把业务代码写在 Controller 里，而是通过 Service 实现。首先创建一个 Service，里面调用 RestTemplate 进行网络请求，当请求异常时直接抛出异常。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@Service
public class UserService {

    @Autowired
    private RestTemplate restTemplate;

    public String getInfo() {
        String url = "http://localhost:8080/xxxxxx";
        ResponseEntity&lt;String&gt; responseEntity = restTemplate.getForEntity(url, String.class);
        // 判断请求是否发生异常
        if(!responseEntity.getStatusCode().is2xxSuccessful()){
            // 抛出异常
            throw new RestClientException(responseEntity.getBody());
        }
        // 没有异常的话则返回正常的响应结果
        return responseEntity.getBody();
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>当然，可以直接对非200状态的返回进行返回处理，这里的示例主要是采用抛出异常，最终统一封装非200状态异常返回对象</p>
</div>
<div class="paragraph">
<p>（2）编写测试Controller，调用 Service 发起请求，然后返回结果。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@RestController
public class HelloController {

    @Autowired
    private UserService userService;

    @GetMapping("/test")
    public String test() {
        return userService.getInfo();
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>（3）封装返回统一结果，由于前面 Service 中将异常抛出了，所以要定义一个全局的异常处理类，捕获这个异常，并返回给前端处理的结果。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@ControllerAdvice
public class CustomExceptionHandler {
    @ExceptionHandler(RestClientException.class)
    public ResponseEntity&lt;String&gt; throwRestException(RestClientException restClientException){
        return new ResponseEntity&lt;String&gt;(restClientException.getMessage(),
            HttpStatus.BAD_REQUEST);
    }
}</pre>
</div>
</div>
<div class="paragraph">
<p>测试一下，可以看到异常信息已经返回到前端页面</p>
</div>
</div>
<div class="sect2">
<h3 id="_微服务中resttemplate使用_精读">3.5. 微服务中RestTemplate使用(精读)</h3>
<div class="paragraph">
<p>RestTemplate为HTTP访问封装了多种方法（例如getForOjbect,getForEntity,postForObject,postForEntity,exchange,excutte,delete,put&#8230;&#8203;），但为了便于进行微服务访问，最应该掌握的方法时exchange.</p>
</div>
<div class="paragraph">
<p>Exchange优势在于：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>（1）允许调用者指定HTTP请求的方法（GET,POST,DELETE等）
（2）可以在请求中增加body以及头信息，其内容通过参数‘HttpEntity&lt;?&gt;requestEntity’描述
（3）exchange支持‘含参数的类型’（即泛型类）作为返回类型，该特性通过‘ParameterizedTypeReference&lt;T&gt;responseType’描述。</pre>
</div>
</div>
<div class="sect3">
<h4 id="_resttemplate_exchange方法">3.5.1. RestTemplate Exchange方法</h4>
<div class="paragraph">
<p>exchange能够配置访问的url参数，requestEntity(header及body),返回体，返回状态status,及返回响应header</p>
</div>
<div class="paragraph">
<p>ResponseEntity&lt;T&gt; results = restTemplate.exchange(url,HttpMethod, requestEntity, T.class, params);</p>
</div>
<div class="listingblock">
<div class="content">
<pre>说明：
1）url: 请求地址；
2）method: 请求类型(如：POST,PUT,DELETE,GET)；
3）requestEntity: 请求实体，封装请求头，请求内容
4）responseType: 响应类型，根据服务接口的返回类型决定(String.class,Map.class)
5）uriVariables: url中参数变量值，包括路径变量</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_springboot常见请求request注解说明_request简单_复杂类型参数传递">3.5.2. Springboot常见请求Request注解说明（Request简单/复杂类型参数传递）</h4>
<div class="paragraph">
<p>为了能够更好的使用RestTemplate访问，需要理解在常见的Controller中常见的前台到后台的参数传递，或者说在访问不同类型需求时，如何正确传递变量，具体说有如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@PathVariable
@RequestParam
@RequestBody</pre>
</div>
</div>
<div class="sect4">
<h5 id="_pathvariable">PathVariable</h5>
<div class="paragraph">
<p>路径参数变量</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@RequestMapping(value = "/info/{userId}", method = RequestMethod.GET)
public User info(@PathVariable("userId") String userId) throws IOException {</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_requestparam">RequestParam</h5>
<div class="paragraph">
<p>url中形参变量，或者说明参变量，常见如?varxxx=&#8230;&#8203;&amp;varyyy=&#8230;&#8203;&amp;varzzz=&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    @GetMapping("/gjjschbyparam")
    public GjjInfo gjjschbyParam(@RequestParam String idcard) {</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_requestbody">RequestBody</h5>
<div class="paragraph">
<p>复杂类型变量传递</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@RequestMapping(value = "/getbook2", method = RequestMethod.POST)
public Book book2(@RequestBody Book book) {</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_get请求">3.5.3. GET请求</h4>
<div class="paragraph">
<p>在微服务中，因为经常在HEADER中设置访问控制及授权等内容，建议使用Exchange替代GetForOjbect及getForEntity。</p>
</div>
<div class="paragraph">
<p>举例如下：</p>
</div>
<div class="paragraph">
<p>（1）路径及参数变量访问</p>
</div>
<div class="listingblock">
<div class="content">
<pre>        String url = BASEURI;
        Map params=[paramval:"666"]
        HttpHeaders headers = new HttpHeaders();
        headers.add("VISITKEY","XXXXXXXXXXXXXXXXXXXXXXXXXXX");
        HttpEntity&lt;String&gt; entity = new HttpEntity&lt;String&gt;(null,headers);
        //GET方式采用品街方法，可以不写最后的参数
        //ResponseEntity&lt;String&gt; resp = restTemplate.exchange(url+"gjjsch/"+"666", HttpMethod.GET, entity, String.class);
        //参数替代方法，即大括号{key},map中包含对应key即value，最终使用value替换对应变量位置
        ResponseEntity&lt;String&gt; resp = restTemplate.exchange(url+"gjjsch/{paramval}", HttpMethod.GET, entity, String.class,params);
        println resp.getHeaders()
        println resp.getStatusCodeValue()
        if(resp.getStatusCode().is2xxSuccessful()){
            println "返回结果："
            println resp.getBody();
        }</pre>
</div>
</div>
<div class="paragraph">
<p>（2）不同返回结果，根据实际情况自行选择设定</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    ResponseEntity&lt;String&gt; resp = restTemplate.exchange(url+"gjjsch/{paramval}", HttpMethod.GET, entity, String.class,params);
    ResponseEntity&lt;Map&gt; resp = restTemplate.exchange(url+"gjjschapiresult/{paramval}", HttpMethod.GET, entity, Map.class,params);
    ResponseEntity&lt;ApiResult&gt; resp = restTemplate.exchange(url+"gjjschapiresult/{paramval}", HttpMethod.GET, entity, ApiResult.class,params);
    //复杂返回数据类型可以使用ParameterizedTypeReference定义
    ResponseEntity&lt;ApiResult&lt;GjjInfo&gt;&gt; resp = restTemplate.exchange(url+"gjjschapiresult/{paramval}", HttpMethod.GET, entity, new ParameterizedTypeReference&lt;ApiResult&lt;GjjInfo&gt;&gt;(){},params);</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_post">3.5.4. POST</h4>
<div class="paragraph">
<p>同样，因为经常在HEADER中设置访问控制及授权等内容，建议使用postForEntity作为常用POST访问方式</p>
</div>
<div class="sect4">
<h5 id="_无参数传递">无参数传递</h5>
<div class="listingblock">
<div class="content">
<pre>    void exchangePostNoParam(){
        String url = BASEURI;
        HttpHeaders headers = new HttpHeaders();
        headers.add("VISITKEY","XXXXXXXXXXXXXXXXXXXXXXXXXXX");
        HttpEntity&lt;String&gt; entity = new HttpEntity&lt;String&gt;(HttpEntity.EMPTY,headers);
        //参数直接拼接
        ResponseEntity&lt;GjjInfo&gt; resp = restTemplate.exchange(url+"testpost?idcard=666", HttpMethod.POST, entity, GjjInfo.class);
        println resp;
        if(resp.getStatusCode().is2xxSuccessful()){
            println "返回结果："
            println resp
        }
        println resp.getHeaders()
        println resp.getStatusCodeValue()
    }</pre>
</div>
</div>
<div class="paragraph">
<p>返回结果开发时可先使用String，输出正常后可转化为对应类型GjjInfo
===== 占位符参数</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    void exchangePostReplaceParam(){
        String url = BASEURI;
        HttpHeaders headers = new HttpHeaders();
        headers.add("VISITKEY","XXXXXXXXXXXXXXXXXXXXXXXXXXX");
        HttpEntity&lt;String&gt; entity = new HttpEntity&lt;String&gt;(HttpEntity.EMPTY,headers);
        //采用占位符，参数可包括多个
        ResponseEntity&lt;GjjInfo&gt; resp = restTemplate.exchange(url+"testpost?idcard={1}", HttpMethod.POST, entity, GjjInfo.class,"777");
        println resp;
        if(resp.getStatusCode().is2xxSuccessful()){
            println "返回结果："
            println resp
        }
        println resp.getHeaders()
        println resp.getStatusCodeValue()
    }</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_map参数传递">Map参数传递</h5>
<div class="literalblock">
<div class="content">
<pre>void exchangePostMapParam(){
    String url = BASEURI;
    Map params=[paramval:"666"]
    HttpHeaders headers = new HttpHeaders();
    headers.add("VISITKEY","XXXXXXXXXXXXXXXXXXXXXXXXXXX");
    HttpEntity&lt;String&gt; entity = new HttpEntity&lt;String&gt;(HttpEntity.EMPTY,headers);
    ResponseEntity&lt;GjjInfo&gt; resp = restTemplate.exchange(url+"testpost?idcard={paramval}", HttpMethod.POST, entity, GjjInfo.class,params);
    println resp;
    if(resp.getStatusCode().is2xxSuccessful()){
        println "返回结果："
        println resp
    }
    println resp.getHeaders()
    println resp.getStatusCodeValue()
}</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_返回为数组类型">3.5.5. 返回为数组类型</h4>
<div class="paragraph">
<p>返回类型可以为Strin,Map等通用类型，也可以返回具体Pojo对象，也可以针对list返回类型使用对象数组接收返回内容</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    void exchangeRespArray(){
        String url = BASEURI;
        Map params=[paramval:"666"]
        HttpHeaders headers = new HttpHeaders();
        headers.add("VISITKEY","XXXXXXXXXXXXXXXXXXXXXXXXXXX");
        HttpEntity&lt;String&gt; entity = new HttpEntity&lt;String&gt;(HttpEntity.EMPTY,headers);
        ResponseEntity&lt;GjjInfo[]&gt; resp = restTemplate.exchange(url+"testgetall?idcard={paramval}", HttpMethod.POST, entity, GjjInfo[].class,params);
        //可以使用String先观察结果
        //ResponseEntity&lt;String&gt; resp = restTemplate.exchange(url+"testgetall?idcard={paramval}", HttpMethod.POST, entity, String.class,params);
        if(resp.getStatusCode().is2xxSuccessful()){
            println "返回结果："
            println resp.getBody()
        }
        println resp.getHeaders()
        println resp.getStatusCodeValue()
    }</pre>
</div>
</div>
<div class="sect4">
<h5 id="__requestbody方式参数对象传递一_pojo">@RequestBody方式参数对象传递一 Pojo</h5>
<div class="listingblock">
<div class="content">
<pre>    void exchangeRequestBodyByString(){
        String url = BASEURI;
        HttpHeaders headers = new HttpHeaders();
        //AJAX请求必须添加
        headers.setContentType(MediaType.APPLICATION_JSON);
        headers.add("VISITKEY","XXXXXXXXXXXXXXXXXXXXXXXXXXX");
        GjjInfo requestobj = new GjjInfo();
        requestobj.setIdcard("888");
        String json = JSON.toJSONString(requestobj);
        HttpEntity&lt;String&gt; requestEntity = new HttpEntity&lt;&gt;(json, headers);
        ResponseEntity&lt;String&gt; resp = restTemplate.exchange(url+"testpostobj", HttpMethod.POST, requestEntity, String.class);
        if(resp.getStatusCode().is2xxSuccessful()){
            println "返回结果："
            println resp.getBody()
        }
        println resp.getHeaders()
        println resp.getStatusCodeValue()
    }</pre>
</div>
</div>
<div class="paragraph">
<p>上述是把对象转换成json字符串，以字符串方式传递，也可以直接将对象传递，如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    void exchangeRequestBodyByPojo(){
        String url = BASEURI;
        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.APPLICATION_JSON);
        headers.add("VISITKEY","XXXXXXXXXXXXXXXXXXXXXXXXXXX");
        GjjInfo requestobj = new GjjInfo();
        requestobj.setIdcard("888");
        //String json = JSON.toJSONString(requestobj);
        HttpEntity&lt;GjjInfo&gt; requestEntity = new HttpEntity&lt;&gt;(requestobj, headers);
        ResponseEntity&lt;String&gt; resp = restTemplate.exchange(url+"testpostobj", HttpMethod.POST, requestEntity, String.class);
        if(resp.getStatusCode().is2xxSuccessful()){
            println "返回结果："
            println resp.getBody()
        }
        println resp.getHeaders()
        println resp.getStatusCodeValue()
    }</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="__requestbody方式参数对象传递一_map">@RequestBody方式参数对象传递一 Map</h5>
<div class="listingblock">
<div class="content">
<pre>    void exchangeRequestBodyByMap(){
        String url = BASEURI;
        HttpHeaders headers = new HttpHeaders();
        //AJAX请求必须添加
        headers.setContentType(MediaType.APPLICATION_JSON);
        headers.add("VISITKEY","XXXXXXXXXXXXXXXXXXXXXXXXXXX");
        Map&lt;String, String&gt; params= new HashMap&lt;String, String&gt;();
        params.put("idcard","999");
        HttpEntity&lt;Map&lt;String, String&gt;&gt; requestEntity = new HttpEntity&lt;&gt;(params, headers);
        ResponseEntity&lt;String&gt; resp = restTemplate.exchange(url+"testpostobj", HttpMethod.POST, requestEntity, String.class);
        if(resp.getStatusCode().is2xxSuccessful()){
            println "返回结果："
            println resp.getBody()
        }
        println resp.getHeaders()
        println resp.getStatusCodeValue()
    }</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_put请求">3.5.6. PUT请求</h4>
<div class="paragraph">
<p>在微服务中，因为经常在HEADER中设置访问控制及授权等内容，建议使用Exchange实现PUT方法。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    void exchangeRequestBodyPut(){
        String url = BASEURI;
        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.APPLICATION_JSON);
        headers.add("VISITKEY","XXXXXXXXXXXXXXXXXXXXXXXXXXX");
        GjjInfo requestobj = new GjjInfo();
        requestobj.setIdcard("888");
        String jsonstr = JSON.toJSONString(requestobj);
        HttpEntity&lt;String&gt; requestEntity = new HttpEntity&lt;&gt;(jsonstr, headers);
        ResponseEntity&lt;Map&gt; resp = restTemplate.exchange(url+"testpostobjnoajax",HttpMethod.PUT, requestEntity, Map.class);
        print resp.getBody()

    }</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_delete请求">3.5.7. DELETE请求</h4>
<div class="paragraph">
<p>在微服务中，因为经常在HEADER中设置访问控制及授权等内容，建议使用Exchange实现DELETE方法。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    void exchangeRequestBodyDelte(){
        String url = BASEURI;
        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.APPLICATION_JSON);
        headers.add("VISITKEY","XXXXXXXXXXXXXXXXXXXXXXXXXXX");
        HttpEntity&lt;String&gt; requestEntity = new HttpEntity&lt;String&gt;(HttpEntity.EMPTY, headers);
        ResponseEntity&lt;Map&gt; resp = restTemplate.exchange(url+"testdelete?id={id}",HttpMethod.DELETE, requestEntity, Map.class,277);
        print resp.getBody()

    }</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_上传文件">3.5.8. 上传文件</h4>
<div class="listingblock">
<div class="content">
<pre>    void exchangeUploadFile(){
        String url = BASEURI;
        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.APPLICATION_JSON_UTF8); // 请求头设置属性
        headers.setContentType(MediaType.parseMediaType("multipart/form-data; charset=UTF-8"));
        headers.add("VISITKEY","XXXXXXXXXXXXXXXXXXXXXXXXXXX");
        File files = new File("C:/test/工行测试报文05221713.txt");
        FileSystemResource resource = new FileSystemResource(files);
        MultiValueMap&lt;String, Object&gt; form = new LinkedMultiValueMap&lt;&gt;();
        form.add("file", resource);
        HttpEntity&lt;MultiValueMap&lt;String, Object&gt;&gt; httpEntity = new HttpEntity&lt;&gt;(form, headers);
        ResponseEntity&lt;Map&gt; resp = restTemplate.exchange(url+"uploadFile",HttpMethod.POST, httpEntity, Map.class);
        print resp.getBody()

    }</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_上传多个文件">3.5.9. 上传多个文件</h4>
<div class="listingblock">
<div class="content">
<pre>   void exchangeUploadFiles(){
        String url = BASEURI;
        HttpHeaders headers = new HttpHeaders();
        //headers.setContentType(MediaType.APPLICATION_JSON_UTF8); // 请求头设置属性
        //headers.setContentType(MediaType.parseMediaType("multipart/form-data; charset=UTF-8"));
        headers.setContentType(MediaType.MULTIPART_FORM_DATA)
        headers.add("VISITKEY","XXXXXXXXXXXXXXXXXXXXXXXXXXX");

        File files = new File("C:/test/工行测试报文05221713.txt");
        File files2 = new File("C:/test/招行BJC205未到账原因_2018041203021561.txt");
        List&lt;Object&gt; upfiles = new ArrayList&lt;&gt;();
        FileSystemResource resource = new FileSystemResource(files);
        FileSystemResource resource2 = new FileSystemResource(files2);
        MultiValueMap&lt;String, Object&gt; form = new LinkedMultiValueMap&lt;&gt;();
        upfiles.add(resource);
        upfiles.add(resource2);
        form.put("files",upfiles)

        HttpEntity&lt;MultiValueMap&lt;String, Object&gt;&gt; httpEntity = new HttpEntity&lt;&gt;(form, headers);
        ResponseEntity&lt;String&gt; resp = restTemplate.exchange(url+"uploadMultipleFiles",HttpMethod.POST, httpEntity, String.class);
        print resp.getBody()

    }</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_下载文件">3.5.10. 下载文件</h4>
<div class="listingblock">
<div class="content">
<pre>    void exchangeDownloadFiles(){
        String url = BASEURI;
        HttpHeaders headers = new HttpHeaders();
        headers.add("VISITKEY","XXXXXXXXXXXXXXXXXXXXXXXXXXX");

        HttpEntity&lt;Resource&gt; httpEntity = new HttpEntity&lt;Resource&gt;(headers);
        ResponseEntity&lt;byte[]&gt; response = restTemplate.exchange(url+"downloadFile/工行测试报文05221713.txt",HttpMethod.GET, httpEntity,  byte[].class);
        println response.getStatusCodeValue()
        println response.getHeaders().getContentType()
        println response.getHeaders().getContentType().getSubtype()
        try {
            File file = File.createTempFile("ess-", "." + response.getHeaders().getContentType().getSubtype());
            println "文件名："+file.getAbsolutePath()+"    "+file.getName()
            FileOutputStream fos = new FileOutputStream(file);
            fos.write(response.getBody());
            fos.flush();
            fos.close();
        } catch (IOException e) {
            e.printStackTrace();
        }


    }</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resttemplate使用详解_略读">4. RestTemplate使用详解（略读）</h2>
<div class="sectionbody">
<div class="paragraph">
<p>此章节仅供巩固理解上一章节中Exchange的参数/对象请求的封装，不同类型返回对象封装</p>
</div>
<div class="sect2">
<h3 id="_get请求_2">4.1. GET请求</h3>
<div class="sect3">
<h4 id="_getforentity">4.1.1. getForEntity</h4>
<div class="paragraph">
<p>getForEntity()方法有如下集中形式：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>public &lt;T&gt; ResponseEntity&lt;T&gt; getForEntity(String url, Class&lt;T&gt; responseType, Object... uriVariables){}
public &lt;T&gt; ResponseEntity&lt;T&gt; getForEntity(String url, Class&lt;T&gt; responseType, Map&lt;String, ?&gt; uriVariables){}
public &lt;T&gt; ResponseEntity&lt;T&gt; getForEntity(URI url, Class&lt;T&gt; responseType){}</pre>
</div>
</div>
<div class="sect4">
<h5 id="_responseentity_httpstatus_bodybuilder结构">ResponseEntity、HttpStatus、BodyBuilder结构</h5>
<div class="paragraph">
<p>ResponseEntity.java</p>
</div>
<div class="listingblock">
<div class="content">
<pre>public HttpStatus getStatusCode(){}
public int getStatusCodeValue(){}
public boolean equals(@Nullable Object other) {}
public String toString() {}
public static BodyBuilder status(HttpStatus status) {}
public static BodyBuilder ok() {}
public static &lt;T&gt; ResponseEntity&lt;T&gt; ok(T body) {}
public static BodyBuilder created(URI location) {}
...</pre>
</div>
</div>
<div class="paragraph">
<p>HttpStatus.java</p>
</div>
<div class="listingblock">
<div class="content">
<pre>public enum HttpStatus {
    public boolean is1xxInformational() {}
    public boolean is2xxSuccessful() {}
    public boolean is3xxRedirection() {}
    public boolean is4xxClientError() {}
    public boolean is5xxServerError() {}
    public boolean isError() {}
}</pre>
</div>
</div>
<div class="paragraph">
<p>BodyBuilder.java</p>
</div>
<div class="listingblock">
<div class="content">
<pre>public interface BodyBuilder extends HeadersBuilder&lt;BodyBuilder&gt; {
    //设置正文的长度，以字节为单位，由Content-Length标头
    BodyBuilder contentLength(long contentLength);
    //设置body的MediaType 类型
    BodyBuilder contentType(MediaType contentType);
    //设置响应实体的主体并返回它。
    &lt;T&gt; ResponseEntity&lt;T&gt; body(@Nullable T body);
｝</pre>
</div>
</div>
<div class="paragraph">
<p>ResponseEntity包含了HttpStatus和BodyBuilder的这些信息，这更方便处理response原生的东西。</p>
</div>
<div class="paragraph">
<p>示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>public void rtGetEntity(){
RestTemplate restTemplate = new RestTemplate();
    ResponseEntity&lt;Notice&gt; entity = restTemplate.getForEntity("http://fantj.top/notice/list/1/5", Notice.class);
    HttpStatus statusCode = entity.getStatusCode();
    System.out.println("statusCode.is2xxSuccessful()"+statusCode.is2xxSuccessful());

    Notice body = entity.getBody();
    System.out.println("entity.getBody()"+body);

    ResponseEntity.BodyBuilder status = ResponseEntity.status(statusCode);
    status.contentLength(100);
    status.body("我在这里添加一句话");
    ResponseEntity&lt;Class&lt;Notice&gt;&gt; body1 = status.body(Notice.class);
    Class&lt;Notice&gt; body2 = body1.getBody();
    System.out.println("body1.toString()"+body1.toString());
}</pre>
</div>
</div>
<div class="paragraph">
<p>getForEntity方法的返回值是一个ResponseEntity&lt;T&gt;，ResponseEntity&lt;T&gt;是Spring对HTTP请求响应的封装，包括了几个重要的元素，如响应码、contentType、contentLength、响应消息体等。比如下面一个例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@RequestMapping("/gethello")
public String getHello() {
    ResponseEntity&lt;String&gt; responseEntity = restTemplate.getForEntity("http://HELLO-SERVICE/hello", String.class);
    String body = responseEntity.getBody();
    HttpStatus statusCode = responseEntity.getStatusCode();
    int statusCodeValue = responseEntity.getStatusCodeValue();
    HttpHeaders headers = responseEntity.getHeaders();
    StringBuffer result = new StringBuffer();
    result.append("responseEntity.getBody()：").append(body).append("&lt;hr&gt;")
        .append("responseEntity.getStatusCode()：").append(statusCode).append("&lt;hr&gt;")
        .append("responseEntity.getStatusCodeValue()：").append(statusCodeValue).append("&lt;hr&gt;")
        .append("responseEntity.getHeaders()：").append(headers).append("&lt;hr&gt;");
    return result.toString();
}</pre>
</div>
</div>
<div class="paragraph">
<p>关于这段代码，关注如下几点：</p>
</div>
<div class="paragraph">
<p>getForEntity的第一个参数为我要调用的服务的地址，这里我调用了服务提供者提供的/hello接口，注意这里是通过服务名调用而不是服务地址，如果写成服务地址就没法实现客户端负载均衡了。
getForEntity第二个参数String.class表示我希望返回的body类型是String
拿到返回结果之后，将返回结果遍历打印出来</p>
</div>
<div class="paragraph">
<p>在调用服务提供者提供的接口时，可能需要传递参数，有两种不同的方式，如下：</p>
</div>
</div>
<div class="sect4">
<h5 id="_占位符参数传递">占位符参数传递</h5>
<div class="listingblock">
<div class="content">
<pre>@RequestMapping("/sayhello")
public String sayHello() {
ResponseEntity&lt;String&gt; responseEntity = restTemplate.getForEntity("http://HELLO-SERVICE/sayhello?name={1}", String.class, "张三");
return responseEntity.getBody();
}</pre>
</div>
</div>
<div class="paragraph">
<p>可以用一个数字做占位符，最后是一个可变长度的参数，来一一替换前面的占位符</p>
</div>
</div>
<div class="sect4">
<h5 id="_map参数传递_2">Map参数传递</h5>
<div class="listingblock">
<div class="content">
<pre>@RequestMapping("/sayhello2")
public String sayHello2() {
Map&lt;String, String&gt; map = new HashMap&lt;&gt;();
map.put("name", "李四");
ResponseEntity&lt;String&gt; responseEntity = restTemplate.getForEntity("http://HELLO-SERVICE/sayhello?name={name}", String.class, map);
return responseEntity.getBody();
}</pre>
</div>
</div>
<div class="paragraph">
<p>也可以前面使用name={name}这种形式，最后一个参数是一个map，map的key即为前边占位符的名字，map的value为参数值</p>
</div>
</div>
<div class="sect4">
<h5 id="_uri方式传递参数">URI方式传递参数</h5>
<div class="paragraph">
<p>第一个调用地址也可以是一个URI而不是字符串，这个时候我们构建一个URI即可，参数神马的都包含在URI中了，如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@RequestMapping("/sayhello3")
public String sayHello3() {
UriComponents uriComponents = UriComponentsBuilder.fromUriString("http://HELLO-SERVICE/sayhello?name={name}").build().expand("王五").encode();
URI uri = uriComponents.toUri();
ResponseEntity&lt;String&gt; responseEntity = restTemplate.getForEntity(uri, String.class);
return responseEntity.getBody();
}</pre>
</div>
</div>
<div class="paragraph">
<p>通过Spring中提供的UriComponents来构建Uri即可。</p>
</div>
</div>
<div class="sect4">
<h5 id="_返回对象pojo">返回对象Pojo</h5>
<div class="paragraph">
<p>服务提供者不仅可以返回String，也可以返回一个自定义类型的对象，比如我的服务提供者中有如下方法：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@RequestMapping(value = "/getbook1", method = RequestMethod.GET)
public Book book1() {
return new Book("三国演义", 90, "罗贯中", "花城出版社");
}</pre>
</div>
</div>
<div class="paragraph">
<p>对于该方法我可以在服务消费者中通过如下方式来调用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@RequestMapping("/book1")
public Book book1() {
ResponseEntity&lt;Book&gt; responseEntity = restTemplate.getForEntity("http://HELLO-SERVICE/getbook1", Book.class);
return responseEntity.getBody();
}</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_getforobject">4.1.2. getForObject</h4>
<div class="paragraph">
<p>getForObject函数实际上是对getForEntity函数的进一步封装，如果只关注返回的消息体的内容，对其他信息都不关注</p>
</div>
<div class="paragraph">
<p>getForObject也有几个重载方法，如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>public &lt;T&gt; T getForObject(String url, Class&lt;T&gt; responseType, Object... uriVariables){}
public &lt;T&gt; T getForObject(String url, Class&lt;T&gt; responseType, Map&lt;String, ?&gt; uriVariables)
public &lt;T&gt; T getForObject(URI url, Class&lt;T&gt; responseType)
getForObject() 其实比 getForEntity() 多包含了将HTTP转成POJO的功能，但是 getForObject 没有处理 response 的能力。因为它拿到手的就是成型的 pojo 。省略了很多 response 的信息。</pre>
</div>
</div>
<div class="paragraph">
<p>示例POJO对象</p>
</div>
<div class="listingblock">
<div class="content">
<pre>public class Notice {
    private int status;
    private Object msg;
    private List&lt;DataBean&gt; data;
}
public  class DataBean {
    private int noticeId;
    private String noticeTitle;
    private Object noticeImg;
    private long noticeCreateTime;
    private long noticeUpdateTime;
    private String noticeContent;
}</pre>
</div>
</div>
<div class="sect4">
<h5 id="_无参数访问">无参数访问</h5>
<div class="listingblock">
<div class="content">
<pre>public void restTemplateGetTest(){
    RestTemplate restTemplate = new RestTemplate();
    Notice notice = restTemplate.getForObject("http://xxx.top/notice/list/1/5", Notice.class);
    System.out.println(notice);
}</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_占位符参数访问">4.1.3. 占位符参数访问</h4>
<div class="listingblock">
<div class="content">
<pre>Notice notice = restTemplate.getForObject("http://fantj.top/notice/list/{1}/{2}", Notice.class,1,5);</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_map参数访问">4.1.4. Map参数访问</h4>
<div class="listingblock">
<div class="content">
<pre>Map&lt;String,String&gt; map = new HashMap();
map.put("start","1");
map.put("page","5");
Notice notice = restTemplate.getForObject("http://fantj.top/notice/list/", Notice.class,map);</pre>
</div>
</div>
<div class="paragraph">
<p>利用map装载参数，应对@PathVariable,@requestparam 参数的url形式。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_post请求">4.2. POST请求</h3>
<div class="paragraph">
<p>在RestTemplate中，POST请求可以通过如下三个方法来发起：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    postForEntity
    postForObject
    postForLocation</pre>
</div>
</div>
<div class="sect3">
<h4 id="_postforentity_带header参数">4.2.1. postForEntity(带Header参数)</h4>
<div class="paragraph">
<p>该方法和get请求中的getForEntity方法类似，如下例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@RequestMapping("/book3")
public Book book3() {
    Book book = new Book();
    book.setName("红楼梦");
    ResponseEntity&lt;Book&gt; responseEntity = restTemplate.postForEntity("http://HELLO-SERVICE/getbook2", book, Book.class);
    return responseEntity.getBody();
}</pre>
</div>
</div>
<div class="paragraph">
<p>方法的第一参数表示要调用的服务的地址，第二个参数表示上传的参数，第三个参数表示返回的消息体的数据类型</p>
</div>
<div class="paragraph">
<p>如果需要带有header参数示例如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>public void rtPostObject(){
    RestTemplate restTemplate = new RestTemplate();
    String url = "http://47.xxx.xxx.96/register/checkEmail";
    HttpHeaders headers = new HttpHeaders();
    headers.setContentType(MediaType.APPLICATION_FORM_URLENCODED);
    MultiValueMap&lt;String, String&gt; map= new LinkedMultiValueMap&lt;&gt;();
    map.add("email", "844072586@qq.com");

    HttpEntity&lt;MultiValueMap&lt;String, String&gt;&gt; request = new HttpEntity&lt;&gt;(map, headers);
    ResponseEntity&lt;String&gt; response = restTemplate.postForEntity( url, request , String.class );
    System.out.println(response.getBody());
}</pre>
</div>
</div>
<div class="paragraph">
<p>MultiValueMap，Map需要灵活掌握，根据传递参数的形式不同，需要探索。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_postforobject">4.3. postForObject</h3>
<div class="paragraph">
<p>如果只关注返回的消息体，可以直接使用postForObject。用法和getForObject一致,三种封装形式如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>public &lt;T&gt; T postForObject(String url, @Nullable Object request, Class&lt;T&gt; responseType, Object... uriVariables) throws RestClientException {}
public &lt;T&gt; T postForObject(String url, @Nullable Object request, Class&lt;T&gt; responseType, Map&lt;String, ?&gt; uriVariables) throws RestClientException {}
public &lt;T&gt; T postForObject(URI url, @Nullable Object request, Class&lt;T&gt; responseType) throws RestClientException {}</pre>
</div>
</div>
<div class="sect3">
<h4 id="_postforlocation">4.3.1. postForLocation</h4>
<div class="paragraph">
<p>postForLocation也是提交新资源，提交成功之后，返回新资源的URI，postForLocation的参数和前面两种的参数基本一致，只不过该方法的返回值为Uri，
这个只需要服务提供者返回一个Uri即可，该Uri表示新资源的位置。</p>
</div>
</div>
<div class="sect3">
<h4 id="_关于multivaluemap说明">4.3.2. 关于MultiValueMap说明</h4>
<div class="paragraph">
<p>public interface MultiValueMap&lt;K, V&gt; extends Map&lt;K, List&lt;V&gt;&gt; {&#8230;&#8203;}
为什么用 MultiValueMap ?因为 HttpEntity 接受的request类型是它。</p>
</div>
<div class="listingblock">
<div class="content">
<pre>public HttpEntity(@Nullable T body, @Nullable MultiValueMap&lt;String, String&gt; headers){}</pre>
</div>
</div>
<div class="paragraph">
<p>这里只展示它的一个construct,从它可以看到我们传入的map是请求体，headers是请求头。</p>
</div>
<div class="paragraph">
<p>为什么用 HttpEntity 是因为 restTemplate.postForEntity 方法虽然表面上接收的request是 @Nullable Object request 类型，
但是你追踪下去会发现，这个 request 是用 HttpEntity 来解析。核心代码如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>if (requestBody instanceof HttpEntity) {
    this.requestEntity = (HttpEntity&lt;?&gt;) requestBody;
}else if (requestBody != null) {
    this.requestEntity = new HttpEntity&lt;&gt;(requestBody);
}else {
    this.requestEntity = HttpEntity.EMPTY;
}</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>曾尝试用map来传递参数，编译不会报错，但是执行不了，是无效的url request请求(400 ERROR)。</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>很难说，我遇到的是map可以应对@requestbody,  如果是@requestparam multifile,需要使用MultiValueMap</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_put请求_2">4.4. PUT请求</h3>
<div class="paragraph">
<p>在RestTemplate中，PUT请求可以通过put方法调用，put方法的参数和前面介绍的postForEntity方法的参数基本一致，只是put方法没有返回值而已。举一个简单的例子，如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@RequestMapping("/put")
public void put() {
    Book book = new Book();
    book.setName("红楼梦");
    restTemplate.put("http://HELLO-SERVICE/getbook3/{1}", book, 99);
}</pre>
</div>
</div>
<div class="paragraph">
<p>book对象是要提交的参数，最后的99用来替换前面的占位符{1}</p>
</div>
</div>
<div class="sect2">
<h3 id="_delete请求_2">4.5. DELETE请求</h3>
<div class="paragraph">
<p>delete请求可以通过delete方法调用来实现，如下例子：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>@RequestMapping("/delete")
public void delete() {
    restTemplate.delete("http://HELLO-SERVICE/getbook4/{1}", 100);
}</pre>
</div>
</div>
<div class="paragraph">
<p>delete方法也有几个重载的方法，不过重载的参数和前面基本一致，不赘述。</p>
</div>
</div>
<div class="sect2">
<h3 id="_exchange">4.6. exchange</h3>
<div class="paragraph">
<p>exchange直接调用execute，返回ResponseEntity对象，它接收HttpMethod参数，可以从外部定义请求方式，例如post请求或者get请求。</p>
</div>
<div class="paragraph">
<p>RestTemplate暴露的exchange与其它接口的不同：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>（1）允许调用者指定HTTP请求的方法（GET,POST,DELETE等）
（2）可以在请求中增加body以及头信息，其内容通过参数‘HttpEntity&lt;?&gt;requestEntity’描述
（3）exchange支持‘含参数的类型’（即泛型类）作为返回类型，该特性通过‘ParameterizedTypeReference&lt;T&gt;responseType’描述。</pre>
</div>
</div>
<div class="sect3">
<h4 id="_使用exchange指定调用方式">4.6.1. 使用exchange指定调用方式</h4>
<div class="listingblock">
<div class="content">
<pre>    //设置请求头
         HttpHeaders headers = new HttpHeaders();
         headers.setContentType(MediaType.APPLICATION_FORM_URLENCODED);
    //调用参数
         MultiValueMap&lt;String, String&gt; params= new LinkedMultiValueMap&lt;&gt;();
         params.add("companyId",companyId.toString());
         params.add("addGoodsList",new Gson().toJson(wmsGoodsDtos));
         params.add("editGoodsList",new Gson().toJson(editWmsGoodsDtos));
         params.add("deleteGoodsIdList",deleteList);
         params.add("platformId",platformId.toString());
         HttpEntity&lt;MultiValueMap&lt;String, String&gt;&gt; requestEntity = new HttpEntity&lt;&gt;(params, headers);
    //  执行HTTP请求
    // 最后的参数需要用String.class  使用其他的会报错
         ResponseEntity&lt;String&gt; response = restTemplate.exchange("请求的接口地址", HttpMethod.POST, requestEntity, String.class);
         String result = response.getBody();</pre>
</div>
</div>
<div class="paragraph">
<p>具体内容，章节二中描述很多，这里不详细说明</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
</div>
</div>
</body>
</html>